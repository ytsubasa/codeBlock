

<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <!-- Ace ã‚¨ãƒ‡ã‚£ã‚¿ã®ãƒ¡ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
        <!-- æ¤œç´¢æ©Ÿèƒ½ã®ãŸã‚ã®æ‹¡å¼µæ©Ÿèƒ½ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ext-searchbox.js"></script>
        <!-- ã‚¨ãƒ‡ã‚£ã‚¿ã®ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾© -->
        <style>
        #editor {
            min-height: 100px; 
            width: 1700px; /* å¹…ã‚’å›ºå®šå€¤1200pxã«è¨­å®š */
            margin-top: 40px; /* ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¨ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ã®é«˜ã•ã‚’è€ƒæ…® */
            overflow-y: hidden; /* å‚ç›´æ–¹å‘ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã‚’éš ã™ */
        }
        #languageSelector, #copyButton, #copySelectedButton {
            position: absolute;
            top: 0px;
            padding: 5px 10px;
            border-radius: 5px;
            background-color: #1c2022;
            color: white;
            border: none;
            outline: none;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
            transition: 0.3s;
        }
        #languageSelector {
            left: 20px;
        }
        #copyButton, #copySelectedButton {
            right: 20px;
        }
        #copyButton {
            top: 0px; /* ä½ç½®ã‚’ä¸Šã«èª¿æ•´ */
        }
        #copyInfo {
            position: absolute; /* çµ¶å¯¾ä½ç½®æŒ‡å®š */
            top: 0px; /* ä½ç½®ã‚’ä¸Šã«èª¿æ•´ */
            right: 160px; /* copyButtonã®å·¦ã«é…ç½®ã™ã‚‹ãŸã‚ã®ä½ç½®èª¿æ•´ */
            padding: 5px 10px; /* å†…éƒ¨ã®ä½™ç™½ */
            border-radius: 5px; /* è§’ã‚’ä¸¸ã */
            background-color: white; /* ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼ã‚’ç™½ã« */
            color: black; /* ãƒ†ã‚­ã‚¹ãƒˆã‚«ãƒ©ãƒ¼ã‚’é»’ã« */
            border: 1px solid black; /* é»’ã„æ ç·šã‚’è¿½åŠ  */
            font-size: 16px; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º */
            cursor: default; /* ã‚«ãƒ¼ã‚½ãƒ«ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã« */
            box-shadow: none; /* å½±ã‚’å‰Šé™¤ */
        }
        
        #copyButton:hover {
            background-color: #063852; /* ãƒ›ãƒãƒ¼æ™‚ã®èƒŒæ™¯è‰²ã‚’å¤‰æ›´ */
        }

        .ace_editor {
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace; /* ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ãƒŸãƒªãƒ¼ã‚’ã‚ˆã‚Šé©åˆ‡ãªã‚‚ã®ã«å¤‰æ›´ */
            font-size: 22px; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’14pxã‹ã‚‰18pxã«å¤‰æ›´ */
            letter-spacing: normal; /* æ–‡å­—é–“éš”ã®èª¿æ•´ */
            line-height: normal; /* è¡Œé–“ã®èª¿æ•´ */
        }

    </style>
    </head>
    <body>
        <!-- è¨€èªé¸æŠã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
        <select id="languageSelector">
           <option value="swift">Swift</option>
           <option value="javascript">JavaScript</option>
           <option value="typescript">TypeScript</option>
           <option value="php">PHP</option>
           <option value="kotlin">Kotlin</option>
           <option value="sql">SQL</option>
           <option value="dart">Dart</option>
           <option value="csharp">C#</option>
           <option value="c_cpp">C++</option>
           <option value="golang">Go</option>
           <option value="html">HTML</option>
           <option value="bash">Bash</option>
           <option value="css">CSS</option>
           <option value="json">JSON</option>
           <option value="python">Python</option>
           <option value="sh">Shell</option>
        </select>

        <!-- ã‚¨ãƒ‡ã‚£ã‚¿ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠ -->
        <div id="editor"> </div>

        <!-- å…¨ä½“ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹æ©Ÿèƒ½ã‚’å‘¼ã³å‡ºã™ãƒœã‚¿ãƒ³ -->
        <button id="copyButton" onclick="copyText()">ã‚³ãƒ”ãƒ¼</button>

        <div id="copyInfo">é¸æŠã‚³ãƒ”ãƒ¼ã¯è‡ªå‹•ã§ã•ã‚Œã¾ã™</div>

        <script>

        window.onload = function() {
    console.log("window.onload â†’ ã‚¨ãƒ‡ã‚£ã‚¿åˆæœŸåŒ–ãƒã‚§ãƒƒã‚¯");
    // ã™ã§ã«ã‚³ãƒ¼ãƒ‰ãŒå…¥ã£ã¦ã„ãªã„å ´åˆã®ã¿ã€ç©ºã‚³ãƒ¼ãƒ‰ã‚’è¨­å®š
    if (!editor.getValue().trim()) {
        console.log("ã‚¨ãƒ‡ã‚£ã‚¿ãŒç©º â†’ å·¦ä¸Šã«åˆæœŸåŒ–");
        setEditorCode("");
    } else {
        console.log("ã‚¨ãƒ‡ã‚£ã‚¿ã«æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã‚ã‚Š â†’ åˆæœŸåŒ–ã‚¹ã‚­ãƒƒãƒ—");
    }
};
       
         
            var editor = ace.edit("editor");
            editor.setTheme("ace/theme/monokai");
            editor.session.setMode("ace/mode/swift");


            editor.container.style.overflow = 'hidden'; // CSSã§ç›´æ¥è¨­å®š

            // ãƒšãƒ¼ã‚¸å…¨ä½“ã§ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ç„¡åŠ¹ã«ã™ã‚‹
            document.body.addEventListener('wheel', function(e) {
                e.preventDefault(); // ãƒã‚¦ã‚¹ãƒ›ã‚¤ãƒ¼ãƒ«ã«ã‚ˆã‚‹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ç„¡åŠ¹ã«
            }, { passive: false });
        
            document.body.addEventListener('touchmove', function(e) {
                e.preventDefault(); // ã‚¿ãƒƒãƒã«ã‚ˆã‚‹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ç„¡åŠ¹ã«
            }, { passive: false });
        
            editor.setOptions({
                 wrap: false, 
                fontSize: "22px"
            });
        


            editor.on('paste', function(e) {
                // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‹ã‚‰ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                var clipboardData = e.text;
            
                // ã‚¨ãƒ‡ã‚£ã‚¿ã«ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã ã‘ã‚’æŒ¿å…¥
                e.text = clipboardData;
            
                // ãƒšãƒ¼ã‚¹ãƒˆç›´å¾Œã«ã‚¨ãƒ‡ã‚£ã‚¿ã®é«˜ã•ã‚’èª¿æ•´ã™ã‚‹é–¢æ•°ã‚’å‘¼ã³å‡ºã™
                setTimeout(function() {
                    adjustEditorHeightAndPostToSwift();
                }, 100); // å°‘ã—é…å»¶ã‚’å…¥ã‚Œã‚‹ã“ã¨ã§DOMã®æ›´æ–°ã‚’å¾…ã¤
            });
            
        
            
        
            editor.setOptions({
                enableBasicAutocompletion: true,  // åŸºæœ¬çš„ãªã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆã‚’æœ‰åŠ¹ã«ã™ã‚‹
                enableSnippets: true,            // ã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’æœ‰åŠ¹ã«ã™ã‚‹
                enableLiveAutocompletion: true,  // ãƒ©ã‚¤ãƒ–ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼‰ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆã‚’æœ‰åŠ¹ã«ã™ã‚‹
                dragEnabled: true,     
                wrap: true   
            });

            editor.on('focus', function() {
                editor.gotoLine(1, 0, false);
            });



            function adjustEditorHeightAndPostToSwift() {
                // ã‚¨ãƒ‡ã‚£ã‚¿ã®å†…å®¹ãŒå®Œå…¨ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ã®ã‚’ç¢ºå®Ÿã«å¾…ã¤ãŸã‚ã®é…å»¶ã‚’è¨­ã‘ã‚‹
                setTimeout(function() {
                    var numberOfRows = editor.getSession().getLength();
                    var lineHeight = editor.renderer.lineHeight;

                    var extraPadding = 65 + (numberOfRows * 3);
        var newHeight = numberOfRows * lineHeight;
                    var minHeight = 100; // æœ€å°é«˜ã•ã‚’è¨­å®š
            
                    newHeight = Math.max(newHeight, minHeight); // æœ€å°é«˜ã•ã‚’ä¿è¨¼ã™ã‚‹
                    document.getElementById('editor').style.height = newHeight + 'px';
                    editor.resize(); // ã‚¨ãƒ‡ã‚£ã‚¿ã®ã‚µã‚¤ã‚ºå¤‰æ›´ã‚’ãƒˆãƒªã‚¬ãƒ¼
            
                    window.webkit.messageHandlers.heightHandler.postMessage(newHeight); // æ–°ã—ã„é«˜ã•ã‚’Swiftã«é€ä¿¡
                }, 100); // é…å»¶æ™‚é–“ã¯100ãƒŸãƒªç§’ã«è¨­å®š
            }
            
        
            editor.getSession().on('change', adjustEditorHeightAndPostToSwift);
            adjustEditorHeightAndPostToSwift(); // åˆæœŸèª­ã¿è¾¼ã¿æ™‚ã«ã‚‚é«˜ã•ã‚’èª¿æ•´
        

            function onEditorContentChange() {
                console.log("codeUpdate event triggered"); // ãƒ‡ãƒãƒƒã‚°ãƒ—ãƒªãƒ³ãƒˆ
                window.webkit.messageHandlers.codeUpdate.postMessage(editor.getValue());
            }
            


            function onLanguageSelectionChange() {
                console.log("languageUpdate event triggered", languageSelector.value); // ãƒ‡ãƒãƒƒã‚°ãƒ—ãƒªãƒ³ãƒˆ
                window.webkit.messageHandlers.languageUpdate.postMessage(languageSelector.value);
            }
            
            


            editor.getSession().on('change', onEditorContentChange);

            languageSelector.onchange = onLanguageSelectionChange;

                        
            function setEditorCode(code) {
                console.log("Setting code in the editor with raw input:", code);
                try {
                    // ãƒ‡ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’ã‚¨ãƒ‡ã‚£ã‚¿ã«è¨­å®š
                    var decodedCode = decodeURIComponent(code);
                    console.log("Decoded code:", decodedCode);
                    editor.setValue(decodedCode, 1); // ã‚«ãƒ¼ã‚½ãƒ«ã‚’æ–‡æ›¸ã®å…ˆé ­ã«è¨­å®š
                    editor.gotoLine(1, 0, true); // ã‚«ãƒ¼ã‚½ãƒ«ã‚’æœ€åˆã®è¡Œã®æœ€åˆã®ä½ç½®ã«ç§»å‹•
                    console.log("Code is set in the editor successfully.");
                } catch (e) {
                    // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                    console.error("Error setting code in the editor: ", e);
                    console.error("Exception details:", e.message, "\nStack trace:", e.stack);
                }
            }
            
            
   function setEditorLanguage(language) {
    console.log("ğŸ”„ Setting Ace Editor language mode to:", language);
    try {
        editor.session.setMode("ace/mode/" + language);

        setTimeout(() => {
            var currentMode = editor.session.getMode().$id;
            console.log("âœ… Ace Editor ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰:", currentMode);
            window.webkit.messageHandlers.languageUpdate?.postMessage(currentMode);
        }, 100);

        // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚‚åŒæœŸ
        var selector = document.getElementById('languageSelector');
        if (selector) selector.value = language;
    } catch (e) {
        console.error("âŒ Error setting language mode:", e);
    }
}


            
            





                

        function copyText() {
            if (editor) { // editor ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å­˜åœ¨ã‚’ç¢ºèª
                var text = editor.getSelectedText() || editor.getValue();
                navigator.clipboard.writeText(text).then(function() {
                    window.webkit.messageHandlers.copyHandler.postMessage(text);
                }).catch(function(error) {
                    console.error('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ', error);
                });
            } else {
                console.error("editor ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæœªå®šç¾©ã§ã™ã€‚");
            }
        }

        editor.getSession().selection.on('changeSelection', function(e) {
            var selectedText = editor.getSelectedText();
            if (selectedText.length > 0) {
                // é¸æŠã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚‹å ´åˆã€ã‚«ã‚¹ã‚¿ãƒ URLã‚’å‘¼ã³å‡ºã™
                var encodedText = encodeURIComponent(selectedText);
                window.location.href = "myapp://copy?text=" + encodedText;
            }
        });


        function copyToClipboard(text) {
            var encodedText = encodeURIComponent(text);
            window.location.href = "myapp://copy?text=" + encodedText;
        }

        
        function selectText(elementId) {
            var text = document.getElementById(elementId);
            var range = document.createRange();
            range.selectNode(text);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
        }


   
        function pasteText() {
            navigator.clipboard.readText().then((text) => {
                // ãƒšãƒ¼ã‚¹ãƒˆã™ã‚‹å ´æ‰€ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ãªã©ï¼‰ã‚’æŒ‡å®šã—ã¦ã€textã‚’æŒ¿å…¥
                document.getElementById('pasteArea').value = text;
            }).catch((err) => {
                console.error('ãƒšãƒ¼ã‚¹ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: ', err);
            });
        }
        

        // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®é¸æŠå¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‡¦ç†ã™ã‚‹
        document.getElementById('languageSelector').addEventListener('change', function() {
            editor.session.setMode("ace/mode/" + this.value);  // ã‚¨ãƒ‡ã‚£ã‚¿ã®ãƒ¢ãƒ¼ãƒ‰ã‚’å¤‰æ›´
        });

        // æ¤œç´¢æ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–
        ace.require("ace/ext/searchbox");

   
        // ãã®ä»–ã®é–¢æ•°ã¨ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼...
    </script>
    </body>
</html>
